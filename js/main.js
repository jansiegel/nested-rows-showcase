var hot;
(function() {
  var data = [{
    wbsSummary: '0000.11.2222.00.2',
    bldgLvl: '0000',
    aera: '00',
    disc: '2222',
    skill: '00',
    costCat: '2',
    units: '1',
    unitCost: 5848,
    wbsCode: '',
    size: '',
    description: '',
    qty: '',
    cost: '',
    hours: '',
    __children: [
      {
        wbsSummary: '',
        bldgLvl: '',
        aera: '',
        disc: '',
        skill: '',
        costCat: '',
        units: '',
        unitCost: '',
        wbsCode: '0000.00.2222.2',
        size: '10x8',
        description: 'Sample description 1.',
        qty: 11,
        cost: 50,
        hours: 2.53
      },
      {
        wbsSummary: '',
        bldgLvl: '',
        aera: '',
        disc: '',
        skill: '',
        costCat: '',
        units: '',
        unitCost: '',
        wbsCode: '0000.00.2222.3',
        size: '10x9',
        description: 'Sample description 2.',
        qty: 12,
        cost: 51,
        hours: 2.54
      },
      {
        wbsSummary: '',
        bldgLvl: '',
        aera: '',
        disc: '',
        skill: '',
        costCat: '',
        units: '',
        unitCost: '',
        wbsCode: '0000.00.2222.4',
        size: '10x10',
        description: 'Sample description 3.',
        qty: 13,
        cost: 52,
        hours: 2.55
      },
      {
        wbsSummary: '',
        bldgLvl: '',
        aera: '',
        disc: '',
        skill: '',
        costCat: '',
        units: '',
        unitCost: '',
        wbsCode: '0000.00.2222.5',
        size: '10x11',
        description: 'Sample description 4.',
        qty: 13,
        cost: 52,
        hours: 2.55
      },
      {
        wbsSummary: '',
        bldgLvl: '',
        aera: '',
        disc: '',
        skill: '',
        costCat: '',
        units: '',
        unitCost: '',
        wbsCode: '0000.00.2222.6',
        size: '10x12',
        description: 'Sample description 5.',
        qty: 14,
        cost: 53,
        hours: 2.56
      },
      {
        wbsSummary: '',
        bldgLvl: '',
        aera: '',
        disc: '',
        skill: '',
        costCat: '',
        units: '',
        unitCost: '',
        wbsCode: '0000.00.2222.7',
        size: '10x13',
        description: 'Sample description 6.',
        qty: 15,
        cost: 54,
        hours: 2.57
      },
    ]
  },
    {
      wbsSummary: '0000.22.3333.00.3',
      bldgLvl: '1111',
      aera: '11',
      disc: '3333',
      skill: '11',
      costCat: '3',
      units: '2',
      unitCost: 5849,
      wbsCode: '',
      size: '',
      description: '',
      qty: '',
      cost: '',
      hours: '',
      __children: [
        {
          wbsSummary: '',
          bldgLvl: '',
          aera: '',
          disc: '',
          skill: '',
          costCat: '',
          units: '',
          unitCost: '',
          wbsCode: '0000.00.2222.2',
          size: '10x8',
          description: 'Sample description 1.',
          qty: 11,
          cost: 50,
          hours: 2.53
        },
        {
          wbsSummary: '',
          bldgLvl: '',
          aera: '',
          disc: '',
          skill: '',
          costCat: '',
          units: '',
          unitCost: '',
          wbsCode: '0000.00.2222.3',
          size: '10x9',
          description: 'Sample description 2.',
          qty: 12,
          cost: 51,
          hours: 2.54
        },
        {
          wbsSummary: '',
          bldgLvl: '',
          aera: '',
          disc: '',
          skill: '',
          costCat: '',
          units: '',
          unitCost: '',
          wbsCode: '0000.00.2222.4',
          size: '10x10',
          description: 'Sample description 3.',
          qty: 13,
          cost: 52,
          hours: 2.55
        },
        {
          wbsSummary: '',
          bldgLvl: '',
          aera: '',
          disc: '',
          skill: '',
          costCat: '',
          units: '',
          unitCost: '',
          wbsCode: '0000.00.2222.5',
          size: '10x11',
          description: 'Sample description 4.',
          qty: 13,
          cost: 52,
          hours: 2.55
        },
        {
          wbsSummary: '',
          bldgLvl: '',
          aera: '',
          disc: '',
          skill: '',
          costCat: '',
          units: '',
          unitCost: '',
          wbsCode: '0000.00.2222.6',
          size: '10x12',
          description: 'Sample description 5.',
          qty: 14,
          cost: 53,
          hours: 2.56
        },
        {
          wbsSummary: '',
          bldgLvl: '',
          aera: '',
          disc: '',
          skill: '',
          costCat: '',
          units: '',
          unitCost: '',
          wbsCode: '0000.00.2222.7',
          size: '10x13',
          description: 'Sample description 6.',
          qty: 15,
          cost: 54,
          hours: 2.57
        },
      ]
    },
    {
      wbsSummary: '0000.33.4444.00.4',
      bldgLvl: '2222',
      aera: '22',
      disc: '4444',
      skill: '22',
      costCat: '4',
      units: '3',
      unitCost: 5850,
      wbsCode: '',
      size: '',
      description: '',
      qty: '',
      cost: '',
      hours: '',
      __children: [
        {
          wbsSummary: '',
          bldgLvl: '',
          aera: '',
          disc: '',
          skill: '',
          costCat: '',
          units: '',
          unitCost: '',
          wbsCode: '0000.00.2222.2',
          size: '10x8',
          description: 'Sample description 1.',
          qty: 11,
          cost: 50,
          hours: 2.53
        },
        {
          wbsSummary: '',
          bldgLvl: '',
          aera: '',
          disc: '',
          skill: '',
          costCat: '',
          units: '',
          unitCost: '',
          wbsCode: '0000.00.2222.3',
          size: '10x9',
          description: 'Sample description 2.',
          qty: 12,
          cost: 51,
          hours: 2.54
        },
        {
          wbsSummary: '',
          bldgLvl: '',
          aera: '',
          disc: '',
          skill: '',
          costCat: '',
          units: '',
          unitCost: '',
          wbsCode: '0000.00.2222.4',
          size: '10x10',
          description: 'Sample description 3.',
          qty: 13,
          cost: 52,
          hours: 2.55
        },
        {
          wbsSummary: '',
          bldgLvl: '',
          aera: '',
          disc: '',
          skill: '',
          costCat: '',
          units: '',
          unitCost: '',
          wbsCode: '0000.00.2222.5',
          size: '10x11',
          description: 'Sample description 4.',
          qty: 13,
          cost: 52,
          hours: 2.55
        },
        {
          wbsSummary: '',
          bldgLvl: '',
          aera: '',
          disc: '',
          skill: '',
          costCat: '',
          units: '',
          unitCost: '',
          wbsCode: '0000.00.2222.6',
          size: '10x12',
          description: 'Sample description 5.',
          qty: 14,
          cost: 53,
          hours: 2.56
        },
        {
          wbsSummary: '',
          bldgLvl: '',
          aera: '',
          disc: '',
          skill: '',
          costCat: '',
          units: '',
          unitCost: '',
          wbsCode: '0000.00.2222.7',
          size: '10x13',
          description: 'Sample description 6.',
          qty: 15,
          cost: 54,
          hours: 2.57
        },
      ]
    }];
  var columnHeaders = [
    'WBS Code Sumarry',
    'Bldg-Lvl',
    'Aera',
    'Disc',
    'Skill',
    'Cost Cat',
    'Units',
    'Unit Cost',
    'WBS Code',
    'Size',
    'Description',
    'Qty',
    'Cost',
    'Hours'
  ];
  var container = document.getElementById('example');

  function bindButtons() {
    var input = document.getElementById('row-to-collapse');
    var toggle = document.getElementById('toggle-section');
    var collapseAll = document.getElementById('collapse-all');
    var expandAll = document.getElementById('expand-all');
    var plugin = hot.getPlugin('nestedRows');

    toggle.addEventListener('mouseup', function(e) {
      var rowIndex = parseInt(input.value, 10);
      if (isNaN(rowIndex) || e.target.className.indexOf('disabled') > -1) {
        return false;
      }

      rowIndex = rowIndex - 1;

      if (plugin.dataManager.hasChildren(rowIndex)) {
        if (plugin.collapsingUI.areChildrenHidden(rowIndex)) {
          plugin.collapsingUI.showChildren(rowIndex);
        } else {
          plugin.collapsingUI.hideChildren(rowIndex);
        }
      }

    });

    collapseAll.addEventListener('mouseup', function(e) {
      plugin.collapsingUI.hideAll();
    });

    expandAll.addEventListener('mouseup', function(e) {
      plugin.collapsingUI.showAll();
    });

    input.addEventListener('input', function(e) {
      var rowIndex = parseInt(e.target.value, 10) - 1;
      var disabledClass = 'disabled';

      if (rowIndex < 0 || rowIndex >= hot.countSourceRows()) {
        if (toggle.className.indexOf(disabledClass) === -1) {
          toggle.className += ' ' + disabledClass;
        }

        return;
      }

      if (plugin.dataManager.hasChildren(rowIndex)) {
        if (toggle.className.indexOf(disabledClass) > -1) {
          toggle.className = toggle.className.replace(disabledClass, '');
        }
      } else {
        if (toggle.className.indexOf(disabledClass) === -1) {
          toggle.className += ' ' + disabledClass;
        }
      }
    });
  }

  hot = new Handsontable(container, {
    data: data,
    colHeaders: columnHeaders,
    rowHeaders: true,
    nestedRows: true,
    colWidths: [130, 60, 50, 50, 50, 65, 50, 65, 110, 50, 150, 50, 50, 50],
    manualColumnResize: true,
    manualRowResize: true,
    bindRowsWithHeaders: true
  });

  bindButtons();
})();